(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2358f3ee"],{"2bf6":function(t,e,s){"use strict";s("a608")},"3b0d":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{ref:"scrollBar",staticClass:"content",attrs:{id:"content"}},t._l(t.contents,(function(e){return a("div",{key:e.id},[e.online?[a("div",{staticClass:"notice"},[a("div",{staticClass:"notice-message"},[t._v(t._s(e.online))])])]:[a("div",{class:[e.UserId===t.currentUser.id?"right-message":"left-message"]},[a("img",{directives:[{name:"show",rawName:"v-show",value:e.UserId!==t.currentUser.id,expression:"content.UserId !== currentUser.id"}],attrs:{src:e.avatar,alt:""}}),a("div",{staticClass:"area"},[a("div",{staticClass:"text"},[t._v(" "+t._s(e.text)+" ")]),a("div",{staticClass:"time"},[t._v(" "+t._s(t._f("dateToString")(e.createdAt))+" ")])])])]],2)})),0),a("div",{staticClass:"input-area"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],attrs:{type:"text",placeholder:"輸入訊息..."},domProps:{value:t.message},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send.apply(null,arguments)},input:function(e){e.target.composing||(t.message=e.target.value)}}}),a("div",{staticClass:"send-icon",on:{click:t.send}},[a("img",{attrs:{src:s("cd5a"),alt:""}})])])])},n=[],i=s("5530"),c=(s("498a"),s("2f62")),r=s("2708"),o={mixins:[r["c"]],props:["contents","logged"],data:function(){return{message:""}},methods:{send:function(){this.message.trim()&&(this.$emit("after-send-message",this.message),this.message="",this.scrollToBottom())},scrollToBottom:function(){this.$refs.scrollBar.scrollTop=this.$refs.scrollBar.scrollHeight}},computed:Object(i["a"])({},Object(c["d"])(["currentUser"])),updated:function(){this.scrollToBottom()},filters:{dateToString:function(t){var e=new Date(t).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"});return"".concat(e)}}},u=o,l=(s("7289"),s("2877")),d=Object(l["a"])(u,a,n,!1,null,"7aba6eb4",null);e["a"]=d.exports},"3b2d":function(t,e,s){"use strict";s("e343")},7289:function(t,e,s){"use strict";s("dc1c")},"72cc":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("Navbar"),s("div",{staticClass:"user-list"},[t._m(0),s("div",{staticClass:"user-list-content"},t._l(t.latestMessages,(function(e){return s("PrivateUserListCard",{key:e.userId,attrs:{latestMessage:e},on:{"after-chat-click":t.afterChatClick}})})),1)]),s("div",{staticClass:"message-content"},[s("div",{staticClass:"title"},[t._v(t._s(t.userChatting||"聊天對象"))]),s("div",{staticClass:"content"},[s("ChatRoomMessage",{attrs:{contents:t.contents,logged:t.logged},on:{"after-send-message":t.afterSendMessage}})],1)])],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title-contianer"},[a("div",{staticClass:"title"},[t._v("訊息")]),a("img",{attrs:{src:s("d26f"),alt:""}})])}],i=s("5530"),c=s("1da1"),r=(s("96cf"),s("d000")),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mescontainer",on:{click:function(e){return t.setChatUser(t.user.id)}}},[s("li",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"card"},[s("img",{attrs:{src:t.user.avatar,alt:""}}),s("div",{staticClass:"card-content"},[s("div",{staticClass:"card-content-info"},[s("span",{staticClass:"name"},[t._v(t._s(t.user.name))]),s("span",{staticClass:"account"},[t._v(" @"+t._s(t.user.account))]),s("span",{staticClass:"created"},[t._v(" "+t._s(t._f("fromNow")(t.latestMessage.createdAt))+" ")])]),s("div",[s("span",{staticClass:"card-content-text"},[t._v(" "+t._s(t._f("nameLength")(t.latestMessage.text)))])])])])])},u=[],l=(s("b0c0"),s("4cce")),d=s("2708"),h={mixins:[d["c"],d["d"]],props:{latestMessage:{type:Object}},data:function(){return{user:{},userChatting:"",isLoading:!0}},methods:{fetchUser:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function s(){var a,n,i,c,r,o;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,l["a"].getUser({userId:t});case 3:a=s.sent,n=a.data,i=n.id,c=n.name,r=n.account,o=n.avatar,e.user={id:i,name:c,account:r,avatar:o},e.userChatting=c,e.isLoading=!1,s.next=14;break;case 11:s.prev=11,s.t0=s["catch"](0),console.log(s.t0);case 14:case"end":return s.stop()}}),s,null,[[0,11]])})))()},setChatUser:function(t){this.$store.commit("setChatUser",this.latestMessage.userId),this.$emit("after-chat-click",t,this.userChatting),console.log(t)}},created:function(){var t=this.latestMessage.userId;this.fetchUser(t)}},m=h,f=(s("3b2d"),s("2877")),g=Object(f["a"])(m,o,u,!1,null,"46b8fa0e",null),v=g.exports,p=s("3b0d"),C=s("2f62"),b=s("d3cc"),_={name:"PrivateChat",components:{Navbar:r["a"],PrivateUserListCard:v,ChatRoomMessage:p["a"]},data:function(){return{roomName:"1",loginUser:[],contents:[],content:{},logged:{},latestMessages:[],userChatting:""}},mounted:function(){this.$socket.open()},sockets:{connect:function(){console.log("socket connected"),this.$socket.emit("login")},message:function(t){this.content=t,this.contents.push(this.content),this.joinRoom()},messageNotRead:function(t){this.$store.commit("updateReadMessage",t),console.log("not read",t)},privateMessage:function(){this.fetchLatest()}},methods:{afterChatClick:function(t,e){this.$store.commit("setChatUser",t),this.joinRoom(),this.fetchChatHistory(t),this.userChatting=e},afterSendMessage:function(t){this.$socket.emit("sendMessage",{text:t,id:this.chatUserId}),this.fetchLatest()},fetchLatest:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b["a"].getLatest();case 2:s=e.sent,console.log(s),t.latestMessages=s.data;case 5:case"end":return e.stop()}}),e)})))()},fetchChatHistory:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function s(){var a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,b["a"].privateHistory({userId:t});case 2:a=s.sent,e.contents=a.data;case 4:case"end":return s.stop()}}),s)})))()},joinRoom:function(){this.$socket.emit("joinRoom",{id:this.chatUserId}),console.log("joined")},leaveRoom:function(){this.$socket.emit("leaveRoom",{id:this.chatUserId}),console.log("left")},messageNotReadInit:function(){this.$socket.emit("messageNotReadInit")}},computed:Object(i["a"])({},Object(C["d"])(["currentUser","chatUserId","updateReadMessage"])),created:function(){var t=this.chatUserId;console.log(t),this.fetchChatHistory(t),this.joinRoom(),this.fetchLatest()},watch:{contents:{handler:function(){this.fetchLatest()}}}},k=_,w=(s("2bf6"),Object(f["a"])(k,a,n,!1,null,"624e5f56",null));e["default"]=w.exports},a608:function(t,e,s){},cd5a:function(t,e,s){t.exports=s.p+"img/send-icon.4d0d1c60.svg"},d26f:function(t,e,s){t.exports=s.p+"img/mail-icon.1db1c50c.svg"},d3cc:function(t,e,s){"use strict";var a=s("2fa3");e["a"]={publicHistory:function(){return a["b"].get("/messages/public")},privateHistory:function(t){var e=t.userId;return a["b"].get("/messages/private/".concat(e))},getLatest:function(){return a["b"].get("/messages/latest")}}},dc1c:function(t,e,s){},e343:function(t,e,s){}}]);
//# sourceMappingURL=chunk-2358f3ee.15a99caf.js.map