(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-69bda988"],{"3b0d":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",{ref:"scrollBar",staticClass:"content",attrs:{id:"content"}},t._l(t.contents,(function(e){return n("div",{key:e.id},[e.online?[n("div",{staticClass:"notice"},[n("div",{staticClass:"notice-message"},[t._v(t._s(e.online))])])]:[n("div",{class:[e.UserId===t.currentUser.id?"right-message":"left-message"]},[n("img",{directives:[{name:"show",rawName:"v-show",value:e.UserId!==t.currentUser.id,expression:"content.UserId !== currentUser.id"}],attrs:{src:e.avatar,alt:""}}),n("div",{staticClass:"area"},[n("div",{staticClass:"text"},[t._v(" "+t._s(e.text)+" ")]),n("div",{staticClass:"time"},[t._v(" "+t._s(t._f("dateToString")(e.createdAt))+" ")])])])]],2)})),0),n("div",{staticClass:"input-area"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],attrs:{type:"text",placeholder:"輸入訊息..."},domProps:{value:t.message},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send.apply(null,arguments)},input:function(e){e.target.composing||(t.message=e.target.value)}}}),n("div",{staticClass:"send-icon",on:{click:t.send}},[n("img",{attrs:{src:s("cd5a"),alt:""}})])])])},a=[],i=s("5530"),o=(s("498a"),s("2f62")),c=s("2708"),r={mixins:[c["c"]],props:["contents","logged"],data:function(){return{message:""}},methods:{send:function(){this.message.trim()&&(this.$emit("after-send-message",this.message),this.message="",this.scrollToBottom())},scrollToBottom:function(){this.$refs.scrollBar.scrollTop=this.$refs.scrollBar.scrollHeight}},computed:Object(i["a"])({},Object(o["d"])(["currentUser"])),updated:function(){this.scrollToBottom()},filters:{dateToString:function(t){var e=new Date(t).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"});return"".concat(e)}}},l=r,u=(s("7289"),s("2877")),d=Object(u["a"])(l,n,a,!1,null,"7aba6eb4",null);e["a"]=d.exports},"4ec9":function(t,e,s){},"55ef":function(t,e,s){"use strict";s("4ec9")},7289:function(t,e,s){"use strict";s("dc1c")},"8c2f":function(t,e,s){"use strict";s("ebfb")},bf48:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chatroom-container"},[s("Navbar"),s("div",{staticClass:"user-list"},[s("div",{staticClass:"title"},[t._v("上線使用者("+t._s(this.loginUser.length)+")")]),s("div",{staticClass:"user-list-content"},t._l(t.loginUser,(function(t){return s("UserListCard",{key:t.id,attrs:{user:t}})})),1)]),s("div",{staticClass:"chat-room-message"},[s("div",{staticClass:"title"},[t._v("公開聊天室")]),s("div",{staticClass:"content"},[s("ChatRoomMessage",{attrs:{contents:t.contents,logged:t.logged},on:{"after-send-message":t.afterSendMessage}})],1)])],1)},a=[],i=s("5530"),o=s("1da1"),c=(s("96cf"),s("d000")),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("router-link",{attrs:{to:{name:"tweet",params:{id:t.user.id}}}},[s("li",{staticClass:"card"},[s("img",{attrs:{src:t.user.avatar,alt:""}}),s("div",{staticClass:"card-info"},[s("span",{staticClass:"name"},[t._v(t._s(t.user.name))]),s("span",{staticClass:"account"},[t._v(" @"+t._s(t.user.account))])])])])],1)},l=[],u={props:{user:{type:Object}}},d=u,m=(s("8c2f"),s("2877")),f=Object(m["a"])(d,r,l,!1,null,"25b6f889",null),g=f.exports,h=s("3b0d"),v=s("2f62"),p=s("d3cc"),b={name:"PublicChat",components:{Navbar:c["a"],UserListCard:g,ChatRoomMessage:h["a"]},data:function(){return{roomName:"public",loginUser:[],contents:[],content:{},logged:{}}},sockets:{connect:function(){console.log("socket connected")},message:function(t){this.content=t,this.contents.push(this.content)},loginUser:function(t){this.loginUser=t},loginStatus:function(t){this.logged=t,this.contents.push({online:t})},messageNotRead:function(t){this.$store.commit("updateReadMessage",t)}},mounted:function(){this.$socket.open()},methods:{afterSendMessage:function(t){this.$socket.emit("sendMessage",{text:t,id:this.currentUser.id,roomName:this.roomName})},fetchChatHistory:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p["a"].publicHistory();case 2:s=e.sent,t.contents=s.data;case 4:case"end":return e.stop()}}),e)})))()},joinRoom:function(){this.$socket.emit("joinRoom",{roomName:this.roomName}),console.log("joined")},leaveRoom:function(){this.$socket.emit("leaveRoom",{roomName:this.roomName}),console.log("left")}},computed:Object(i["a"])({},Object(v["d"])(["currentUser","token"])),created:function(){this.fetchChatHistory(),this.joinRoom()},beforeDestroy:function(){this.leaveRoom()}},C=b,_=(s("55ef"),Object(m["a"])(C,n,a,!1,null,"54eb2071",null));e["default"]=_.exports},cd5a:function(t,e,s){t.exports=s.p+"img/send-icon.4d0d1c60.svg"},d3cc:function(t,e,s){"use strict";var n=s("2fa3");e["a"]={publicHistory:function(){return n["b"].get("/messages/public")},privateHistory:function(t){var e=t.userId;return n["b"].get("/messages/private/".concat(e))},getLatest:function(){return n["b"].get("/messages/latest")}}},dc1c:function(t,e,s){},ebfb:function(t,e,s){}}]);
//# sourceMappingURL=chunk-69bda988.4ba5dbec.js.map